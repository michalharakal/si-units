# Releasing

This document describes the process of development, deploying and releasing a new version of the project.

From experience, the process of development, deployment and releasing a new version 
of the project can be made better manually.  

The table below lists the steps to be taken, corresponded terminal commands 
and quality criteria for completion of each step and moving to the next one.


| Step                                                     | Command                                                                                                                                                                          | Quality Criteria                                                                                                                                                                                                                                           |
|----------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Cleanup                                                  | ./gradlew clean                                                                                                                                                                  | No build directories in main project directory and sub-project directories.                                                                                                                                                                                |
| Sources generation                                       | ./gradlew :kotunil-generators:run                                                                                                                                                | Generation without errors.                                                                                                                                                                                                                                 |    
| Library development                                      | ./gradlew :kotunil:build                                                                                                                                                         | Build without errors.                                                                                                                                                                                                                                      |                                                                                                                               |
| Publishing in mavenLocal                                 | ./gradlew :kotunil:publishToMavenLocal                                                                                                                                           | No errors. All expected libraries with corresponded creation time can be found in directory /Users/USER/.m2/repository/eu/sirotin/kotunil/kotunil-jvm/VERSION                                                                                              |
| Switch JVM apps to mavenLocal version of library         | ./gradlew :switchJvmTestAppsToMavenLocal                                                                                                                                         | 1) Check apps\java-console\build.gradle.kts that it uses mavenLocal as repository. 2) Check apps\kotlin-console\build.gradle.kts that it uses mavenLocal as repository.                                                                                    |
| Build and test java app with local version of library    | 1) Set in si-units\build.gradle.kts val kotunilJvmStableVersion = kotunilVersion. 2) Update gradle. 3) ./gradlew :apps:jvm:java-console:run                                      | Check table in output. Compare expectations and tests results.                                                                                                                                                                                             |
| Build and test kotlin app with local version of library  | 1) ./gradlew :apps:jvm:kotlin-console:run                                                                                                                                        | Check table in output. Compare expectations and tests results.                                                                                                                                                                                             |
| Publishing JS part locally                               | 1) ./gradlew :js-lib:clean 2) ./gradlew :js-lib:build                                                                                                                            | File js-lib\dist\package.json contains line "version": "<version>",                                                                                                                                                                                        |
| Test node_ts app with local version of library           | 1) ./gradlew :apps:node_ts_app:switchNodeTestToLocalJsLibrary 2)./gradlew :apps:node_ts_app:clean 3)./gradlew :apps:node_ts_app:build 4)./gradlew :apps:node_ts_app:startConsole | 1) Check that file apps/node_ts_app/node_modules/kotunil-js-lib/package.json uses right version. 2) Check output in terminal. Compare expectation and test results in the table console output.                                                            |
| Test web_app_js app with local version of library        | 1)./gradlew :apps:web_app_js:clean 2)./gradlew :apps:web_app_js:build 3) In IDE select index.html ans start it (e.g. with popup-menu command "Open in..."                        | 1) Check that file apps/web_app_js/lib/package.json uses right version. 2) Check output in browser. Should be 3 lines: L1)Number tests (checks):1078  L2)Number KotUniL's tested objects: 61 L3)Number errors:0                                            |
| Publishing in mavenCentral                               | 1)./gradlew :kotunil:publish 2) Continue process manually                                                                                                                        | 1) Check availability of new version on https://central.sonatype.com/search?q=eu.sirotin.kotunil                                                                                                                                                           |
| Switch JVM apps to mavenCentral version of library       | ./gradlew :switchJvmTestAppsToMavenCentral                                                                                                                                       | 1) Check apps\java-console\build.gradle.kts that it uses mavenCentral as repository. 2) Check apps\kotlin-console\build.gradle.kts that it uses mavenCentral as repository.                                                                                |
| Build and test java app with global version of library   | 1) ./gradlew :apps:jvm:java-console:run                                                                                                                                          | Check table in output. Compare expectations and tests results.                                                                                                                                                                                             |
| Build and test kotlin app with global version of library | 1) ./gradlew :apps:jvm:kotlin-console:run                                                                                                                                        | Check table in output. Compare expectations and tests results.                                                                                                                                                                                             |
| Publishing JS part in (global) NPM                       | 1)./gradlew :js-lib:publishToGlobalMPM                                                                                                                                           | Check availability of new version on https://www.npmjs.com/package/kotunil-js-lib                                                                                                                                                                          |
| Test node_ts app with global version of library          | 1) ./gradlew :apps:node_ts_app:switchToMPNCentral 2)./gradlew :apps:node_ts_app:clean 3)./gradlew :apps:node_ts_app:build 4)./gradlew :apps:node_ts_app:startConsole             | 1) Check that file apps/node_ts_app/node_modules/kotunil-js-lib/package.json uses right version. Should be equals kotunilJsVersion from root build.gradle.kts 2) Check output in terminal. Compare expectation and real values in table in console output. |
| Publishing documentation                                 | TODO                                                                                                                                                                             |                                                                                                                                                                                                                                                            |
| Publishing in GitHub releases                            | 1) Commit with #Release <version-number> 2) Process releasing in GitHub Web UI                                                                                                   |                                                                                                                                                                                                                                                            |
